
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../data_structures/">
      
      
        <link rel="next" href="../query_engine_interface/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.10">
    
    
      
        <title>Usage guide - Spoc</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e359304.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#query-engine" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Spoc" class="md-header__button md-logo" aria-label="Spoc" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Spoc
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Usage guide
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/gerlichlab/spoc" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    gerlichlab/spoc
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href=".." class="md-tabs__link">
          
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../data_structures/" class="md-tabs__link">
        
  
    
  
  Data Structures

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  Query Engine

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../contributing/" class="md-tabs__link">
        
  
    
  
  Contributing

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../cli/" class="md-tabs__link">
          
  
  API

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Spoc" class="md-nav__button md-logo" aria-label="Spoc" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Spoc
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/gerlichlab/spoc" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    gerlichlab/spoc
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcomde to spoc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../load_example_dataset/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Load example dataset
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../transformation_pipeline/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transformation pipeline
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../data_structures/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Structures
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Query Engine
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Query Engine
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Usage guide
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Usage guide
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#principles" class="md-nav__link">
    <span class="md-ellipsis">
      Principles
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Principles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#composable-pieces" class="md-nav__link">
    <span class="md-ellipsis">
      Composable pieces
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lazy-evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      Lazy evaluation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#query-plans-and-query-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Query plans and query steps
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Query plans and query steps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#input-and-output-of-query-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Input and output of query steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#composition-of-query-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Composition of query steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manifestation-of-results" class="md-nav__link">
    <span class="md-ellipsis">
      Manifestation of results
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#selecting-a-subset-of-contacts-at-a-single-genomic-position" class="md-nav__link">
    <span class="md-ellipsis">
      Selecting a subset of contacts at a single genomic position
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#selecting-a-subset-of-contacts-at-multiple-genomic-regions" class="md-nav__link">
    <span class="md-ellipsis">
      Selecting a subset of contacts at multiple genomic regions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calculating-the-distance-to-a-target-region-and-aggregating-the-result" class="md-nav__link">
    <span class="md-ellipsis">
      Calculating the distance to a target region and aggregating the result
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregating-genomic-data-based-on-its-distance-to-a-target-region" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregating genomic data based on it's distance to a target region
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../query_engine_interface/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Class interface
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CLI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../io/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IO
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contacts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contacts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fragments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fragments
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pixels/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pixels
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../query_engine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Query Engine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataframe_models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dataframe models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../file_parameters_models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    File parameters models
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#principles" class="md-nav__link">
    <span class="md-ellipsis">
      Principles
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Principles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#composable-pieces" class="md-nav__link">
    <span class="md-ellipsis">
      Composable pieces
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lazy-evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      Lazy evaluation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#query-plans-and-query-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Query plans and query steps
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Query plans and query steps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#input-and-output-of-query-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Input and output of query steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#composition-of-query-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Composition of query steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manifestation-of-results" class="md-nav__link">
    <span class="md-ellipsis">
      Manifestation of results
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#selecting-a-subset-of-contacts-at-a-single-genomic-position" class="md-nav__link">
    <span class="md-ellipsis">
      Selecting a subset of contacts at a single genomic position
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#selecting-a-subset-of-contacts-at-multiple-genomic-regions" class="md-nav__link">
    <span class="md-ellipsis">
      Selecting a subset of contacts at multiple genomic regions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calculating-the-distance-to-a-target-region-and-aggregating-the-result" class="md-nav__link">
    <span class="md-ellipsis">
      Calculating the distance to a target region and aggregating the result
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregating-genomic-data-based-on-its-distance-to-a-target-region" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregating genomic data based on it's distance to a target region
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="query-engine">Query engine</h1>
<p>This technical document describes the spoc query engine, a set of classes that implements spoc's interface for querying multi-dimensional genomic data.</p>
<h2 id="principles">Principles</h2>
<h3 id="composable-pieces">Composable pieces</h3>
<p>Spoc's query engine consists of composable pieces that can be combined to produce an expressive query language. These pieces represent basic operations on genomic data that are easily implemented and understood on their own. This allows a great degree of flexibility, while also allowing predefined recipes that less experienced users can get started with.</p>
<h3 id="lazy-evaluation">Lazy evaluation</h3>
<p>The spoc query engine is designed with lazy evaluation as a guiding principle. This means that data queries are only executed when they are needed to minimize loading data into memory and computational overhead. To enable this, spoc queries have a construction phase, which specifies the operations to be executed and an execution phase, that actually executes the query.</p>
<h2 id="query-plans-and-query-steps">Query plans and query steps</h2>
<p>The most important ingredient in this query language is a class that implements the <code>QueryStep</code> protocol. This protocol serves two purposes:</p>
<ul>
<li>It exposes a way to validate the data schema during query building</li>
<li>It implements adding itself to a query</li>
</ul>
<p>This way, query steps can be combined into a query plan that specifies the analysis to be executed. In generaly, spoc supports the following types of query steps:</p>
<ul>
<li><strong>Overlap</strong>: Overlaps genomic data with a set of genomic intervals</li>
<li><strong>Aggregation</strong>: Aggregates the data passed into the query using an aggregation function</li>
<li><strong>Transform</strong>: Adds columns to query based on a fixed or custom computation</li>
</ul>
<p>Specific examples of query steps are:</p>
<ul>
<li><strong>DistanceTransformation</strong>: Example of a transfomration. Adds distance of genomic positions to regions added by Overlap</li>
<li><strong>DistanceAggregation</strong>: Exaple of an aggregation. Aggregates the distances to genomic regions using an aggregation function.</li>
</ul>
<h3 id="input-and-output-of-query-steps">Input and output of query steps</h3>
<p>A query step takes as input a class that implements the <code>GenomicData</code> protocol. This protocol allows retrievel of the data schema (a thin wrapper over a pandera dataframe schema) as well as the data itself. The output of a query step is again a class that ipmlements the <code>GenomicData</code> protocol to allow composition. Specific examples of possible inputs are:</p>
<ul>
<li><strong>Pixels</strong>: Represents input pixels</li>
<li><strong>Contacts</strong>: Represents input contacts</li>
<li><strong>QueryPlan</strong>: The result of a query step</li>
</ul>
<h3 id="composition-of-query-steps">Composition of query steps</h3>
<p>To allow specifying complex queries, query steps need to be combined. This is done using the <code>Query</code> class. It takes a query plan (a list of <code>QueryStep</code> instances) as input, exposes the <code>build</code> method, which takes input data, validates all query steps and adds them to the resulting <code>QueryPlan</code> instance that is returned.</p>
<h3 id="manifestation-of-results">Manifestation of results</h3>
<p>So far, we have only talked about specifying the query to be executed, but not how to actually execute it. A <code>QueryPlan</code> has a <code>compute()</code> method that returns the manifested dataframe as a <code>pd.DataFrame</code> instance. This is the step that actually executes the specified query.</p>
<h2 id="examples">Examples</h2>
<h3 id="selecting-a-subset-of-contacts-at-a-single-genomic-position">Selecting a subset of contacts at a single genomic position</h3>
<p>In this example, we want to select a subset of genomic contacts at a single location. For this, we first load the required input data:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span> <span class="nn">spoc.query_engine</span> <span class="kn">import</span> <span class="n">Overlap</span><span class="p">,</span> <span class="n">Anchor</span><span class="p">,</span> <span class="n">Query</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">from</span> <span class="nn">spoc.contacts</span> <span class="kn">import</span> <span class="n">Contacts</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="n">contacts</span> <span class="o">=</span> <span class="n">Contacts</span><span class="o">.</span><span class="n">from_uri</span><span class="p">(</span><span class="s2">&quot;../tests/test_files/contacts_unlabelled_2d_v2.parquet::2&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p>Then we specify a target region</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">target_region</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>    <span class="s2">&quot;chrom&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;chr1&#39;</span><span class="p">],</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">],</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>    <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">400</span><span class="p">],</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="p">})</span>
</span></code></pre></div>
<p>First, we want to select all contacts where any of the fragments constituting the contact overlaps the target region. To perform this action, we use the Overlap class and pass the target region as well as an instance of the <code>Anchor</code> class. The <code>Anchor</code> dataclass allows us to specify how we want to filter contacts for region overlap. It has two attributes <code>mode</code> and <code>anchors</code>. <code>Anchors</code> indicates the positions we want to filter on (default is all positions) and <code>mode</code> specifies whether we require all positions to overlap or any position to overlap. So for example, if we want all of our two-way contacts for which any of the positions overlap, we would use <code>Anchor(mode='ANY', anchors=[1,2])</code>.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">query_steps</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    <span class="n">Overlap</span><span class="p">(</span><span class="n">target_region</span><span class="p">,</span> <span class="n">anchor_mode</span><span class="o">=</span><span class="n">Anchor</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;ANY&quot;</span><span class="p">,</span> <span class="n">anchors</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="p">]</span>
</span></code></pre></div>
<p>A query plan is a list of qury steps that can be used in the basic query class</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="n">query_steps</span><span class="o">=</span><span class="n">query_steps</span><span class="p">)</span>
</span></code></pre></div>
<p>The <code>.build</code> method executes the query plan and retuns a <code>QueryPlan</code> object</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">result</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">contacts</span><span class="p">)</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="n">result</span>
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code>&lt;spoc.query_engine.QueryPlan at 0x1804b711a00&gt;
</code></pre></div>
<p>The <code>.load_result</code> method of the <code>QueryResult</code> object can be executed using <code>.load_result</code>, which returns a <code>pd.DataFrame</code>. The resulting dataframe has additional columns that represent the regions, with which the input contacts overlapped.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">df</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;chrom|start|end|id&quot;</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>chrom_1</th>
      <th>start_1</th>
      <th>end_1</th>
      <th>chrom_2</th>
      <th>start_2</th>
      <th>end_2</th>
      <th>region_chrom</th>
      <th>region_start</th>
      <th>region_end</th>
      <th>region_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>chr1</td>
      <td>100</td>
      <td>200</td>
      <td>chr1</td>
      <td>1000</td>
      <td>2000</td>
      <td>chr1</td>
      <td>100</td>
      <td>400</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>chr1</td>
      <td>2000</td>
      <td>3000</td>
      <td>chr1</td>
      <td>200</td>
      <td>300</td>
      <td>chr1</td>
      <td>100</td>
      <td>400</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>chr1</td>
      <td>3000</td>
      <td>4000</td>
      <td>chr1</td>
      <td>300</td>
      <td>400</td>
      <td>chr1</td>
      <td>100</td>
      <td>400</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>

<p>We can also restrict the positions to filter on, by passing different anchor parameters. For example, we can filter for contacts, where the first position overlaps with our target:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">query_steps</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    <span class="n">Overlap</span><span class="p">(</span><span class="n">target_region</span><span class="p">,</span> <span class="n">anchor_mode</span><span class="o">=</span><span class="n">Anchor</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;ANY&quot;</span><span class="p">,</span> <span class="n">anchors</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="p">]</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="n">Query</span><span class="p">(</span><span class="n">query_steps</span><span class="o">=</span><span class="n">query_steps</span><span class="p">)</span>\
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>    <span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">contacts</span><span class="p">)</span>\
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>    <span class="o">.</span><span class="n">compute</span><span class="p">()</span>\
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;chrom|start|end|id&quot;</span><span class="p">)</span>
</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>chrom_1</th>
      <th>start_1</th>
      <th>end_1</th>
      <th>chrom_2</th>
      <th>start_2</th>
      <th>end_2</th>
      <th>region_chrom</th>
      <th>region_start</th>
      <th>region_end</th>
      <th>region_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>chr1</td>
      <td>100</td>
      <td>200</td>
      <td>chr1</td>
      <td>1000</td>
      <td>2000</td>
      <td>chr1</td>
      <td>100</td>
      <td>400</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>

<p>This time, only the first contact overlaps.</p>
<p>The same functionality is implemented also for the Pixels class</p>
<h2 id="selecting-a-subset-of-contacts-at-multiple-genomic-regions">Selecting a subset of contacts at multiple genomic regions</h2>
<p>The Overlap class is also capable of selecting contacts at multiple genomic regions. Here, the behavior of <code>Overlap</code> deviates from a simple filter, because if a given contact overlaps with multiple regions, it will be returned multiple times.</p>
<p>Specify target regions</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">target_regions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>    <span class="s2">&quot;chrom&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;chr1&#39;</span><span class="p">,</span> <span class="s1">&#39;chr1&#39;</span><span class="p">],</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">],</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">400</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="p">})</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">query_steps</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>    <span class="n">Overlap</span><span class="p">(</span><span class="n">target_regions</span><span class="p">,</span> <span class="n">anchor_mode</span><span class="o">=</span><span class="n">Anchor</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;ANY&quot;</span><span class="p">,</span> <span class="n">anchors</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="p">]</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="n">Query</span><span class="p">(</span><span class="n">query_steps</span><span class="o">=</span><span class="n">query_steps</span><span class="p">)</span>\
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>    <span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">contacts</span><span class="p">)</span>\
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>    <span class="o">.</span><span class="n">compute</span><span class="p">()</span>\
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;chrom|start|end|id&quot;</span><span class="p">)</span>
</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>chrom_1</th>
      <th>start_1</th>
      <th>end_1</th>
      <th>chrom_2</th>
      <th>start_2</th>
      <th>end_2</th>
      <th>region_chrom</th>
      <th>region_start</th>
      <th>region_end</th>
      <th>region_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>chr1</td>
      <td>100</td>
      <td>200</td>
      <td>chr1</td>
      <td>1000</td>
      <td>2000</td>
      <td>chr1</td>
      <td>100</td>
      <td>400</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>chr1</td>
      <td>100</td>
      <td>200</td>
      <td>chr1</td>
      <td>1000</td>
      <td>2000</td>
      <td>chr1</td>
      <td>150</td>
      <td>200</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>

<p>In this example, the contact overlapping both regions is duplicated.</p>
<p>The same functionality is implemented also for the pixels class.</p>
<h2 id="calculating-the-distance-to-a-target-region-and-aggregating-the-result">Calculating the distance to a target region and aggregating the result</h2>
<p>In this example, we calculate the distance of pixels to target regions and aggregate based on the distances. This is a very common use case in so-called pileup analyses, where we want to investigate the average behavior around regions of interest.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="kn">from</span> <span class="nn">spoc.pixels</span> <span class="kn">import</span> <span class="n">Pixels</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="kn">from</span> <span class="nn">spoc.query_engine</span> <span class="kn">import</span> <span class="n">DistanceTransformation</span><span class="p">,</span> <span class="n">DistanceMode</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
</span></code></pre></div>
<p>First we define a set of target pixels</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">def</span> <span class="nf">complete_synthetic_pixels</span><span class="p">():</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Pixels that span two regions densely&quot;&quot;&quot;</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>    <span class="c1"># genomic region_1</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>    <span class="n">pixels_1</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>        <span class="p">{</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>            <span class="s2">&quot;chrom&quot;</span><span class="p">:</span> <span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>            <span class="s2">&quot;start_1&quot;</span><span class="p">:</span> <span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>            <span class="s2">&quot;start_2&quot;</span><span class="p">:</span> <span class="n">tup</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>            <span class="s2">&quot;start_3&quot;</span><span class="p">:</span> <span class="n">tup</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>            <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>        <span class="p">}</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>        <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>            <span class="p">[</span><span class="s2">&quot;chr1&quot;</span><span class="p">],</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">900_000</span><span class="p">,</span> <span class="mi">1_150_000</span><span class="p">,</span> <span class="mi">50_000</span><span class="p">),</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">900_000</span><span class="p">,</span> <span class="mi">1_150_000</span><span class="p">,</span> <span class="mi">50_000</span><span class="p">),</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">900_000</span><span class="p">,</span> <span class="mi">1_150_000</span><span class="p">,</span> <span class="mi">50_000</span><span class="p">),</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>        <span class="p">)</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>    <span class="p">]</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a>    <span class="c1"># genomic region_2</span>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a>    <span class="n">pixels_2</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a>        <span class="p">{</span>
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a>            <span class="s2">&quot;chrom&quot;</span><span class="p">:</span> <span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>            <span class="s2">&quot;start_1&quot;</span><span class="p">:</span> <span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a>            <span class="s2">&quot;start_2&quot;</span><span class="p">:</span> <span class="n">tup</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a>            <span class="s2">&quot;start_3&quot;</span><span class="p">:</span> <span class="n">tup</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
</span><span id="__span-10-27"><a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a>            <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
</span><span id="__span-10-28"><a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a>        <span class="p">}</span>
</span><span id="__span-10-29"><a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a>        <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span>
</span><span id="__span-10-30"><a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a>            <span class="p">[</span><span class="s2">&quot;chr2&quot;</span><span class="p">],</span>
</span><span id="__span-10-31"><a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a>            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">900_000</span><span class="p">,</span> <span class="mi">1_150_000</span><span class="p">,</span> <span class="mi">50_000</span><span class="p">),</span>
</span><span id="__span-10-32"><a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a>            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">900_000</span><span class="p">,</span> <span class="mi">1_150_000</span><span class="p">,</span> <span class="mi">50_000</span><span class="p">),</span>
</span><span id="__span-10-33"><a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a>            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">900_000</span><span class="p">,</span> <span class="mi">1_150_000</span><span class="p">,</span> <span class="mi">50_000</span><span class="p">),</span>
</span><span id="__span-10-34"><a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a>        <span class="p">)</span>
</span><span id="__span-10-35"><a id="__codelineno-10-35" name="__codelineno-10-35" href="#__codelineno-10-35"></a>    <span class="p">]</span>
</span><span id="__span-10-36"><a id="__codelineno-10-36" name="__codelineno-10-36" href="#__codelineno-10-36"></a>    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pixels_1</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pixels_2</span><span class="p">)))</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">pixels</span> <span class="o">=</span> <span class="n">Pixels</span><span class="p">(</span><span class="n">complete_synthetic_pixels</span><span class="p">(),</span> <span class="n">number_fragments</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">binsize</span><span class="o">=</span><span class="mi">50_000</span><span class="p">)</span>
</span></code></pre></div>
<p>Then we define the target regions we are interested in.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">target_regions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>        <span class="p">{</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>            <span class="s2">&quot;chrom&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;chr1&quot;</span><span class="p">,</span> <span class="s2">&quot;chr2&quot;</span><span class="p">],</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>            <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">900_000</span><span class="p">,</span> <span class="mi">900_000</span><span class="p">],</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>            <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1_100_000</span><span class="p">,</span> <span class="mi">1_100_000</span><span class="p">],</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>        <span class="p">}</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>    <span class="p">)</span>
</span></code></pre></div>
<p>We are then interested in selecting all contacts that are contained within these pixels and then calculate the distance to them. The selection step can be done with the <code>Overlap</code> class that we described above. The distance transformation can be done with the <code>DistanceTransformation</code> query step. This query step takes an instance of genomic data that contains regions (as defined by it's schema) and calculates the distance to all position columns. All distances are calculated with regards to the center of each assigned region. Since genomic positions are defined by a start and end,the <code>DistanceTransformation</code> query step has a <code>DistanceMode</code> parameter that defines whether we would like to calculate the distance with regard to the start of a genomic position, the end or it's center.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">query_steps</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>    <span class="n">Overlap</span><span class="p">(</span><span class="n">target_regions</span><span class="p">,</span> <span class="n">anchor_mode</span><span class="o">=</span><span class="n">Anchor</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;ANY&quot;</span><span class="p">)),</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>    <span class="n">DistanceTransformation</span><span class="p">(</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>        <span class="n">distance_mode</span><span class="o">=</span><span class="n">DistanceMode</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>    <span class="p">),</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="p">]</span>
</span></code></pre></div>
<p>We can then execute this query plan using the Query class. This well add an distance column to the genomic dataset returned.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">Query</span><span class="p">(</span><span class="n">query_steps</span><span class="o">=</span><span class="n">query_steps</span><span class="p">)</span>\
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>    <span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">pixels</span><span class="p">)</span>\
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>    <span class="o">.</span><span class="n">compute</span><span class="p">()</span>\
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;chrom|distance&quot;</span><span class="p">)</span>
</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>chrom_1</th>
      <th>chrom_2</th>
      <th>chrom_3</th>
      <th>region_chrom</th>
      <th>distance_1</th>
      <th>distance_2</th>
      <th>distance_3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>chr1</td>
      <td>chr1</td>
      <td>chr1</td>
      <td>chr1</td>
      <td>-100000.0</td>
      <td>-100000.0</td>
      <td>-100000.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>chr1</td>
      <td>chr1</td>
      <td>chr1</td>
      <td>chr1</td>
      <td>-100000.0</td>
      <td>-100000.0</td>
      <td>-50000.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>chr1</td>
      <td>chr1</td>
      <td>chr1</td>
      <td>chr1</td>
      <td>-100000.0</td>
      <td>-100000.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>chr1</td>
      <td>chr1</td>
      <td>chr1</td>
      <td>chr1</td>
      <td>-100000.0</td>
      <td>-100000.0</td>
      <td>50000.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>chr1</td>
      <td>chr1</td>
      <td>chr1</td>
      <td>chr1</td>
      <td>-100000.0</td>
      <td>-100000.0</td>
      <td>100000.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>245</th>
      <td>chr2</td>
      <td>chr2</td>
      <td>chr2</td>
      <td>chr2</td>
      <td>100000.0</td>
      <td>100000.0</td>
      <td>-100000.0</td>
    </tr>
    <tr>
      <th>246</th>
      <td>chr2</td>
      <td>chr2</td>
      <td>chr2</td>
      <td>chr2</td>
      <td>100000.0</td>
      <td>100000.0</td>
      <td>-50000.0</td>
    </tr>
    <tr>
      <th>247</th>
      <td>chr2</td>
      <td>chr2</td>
      <td>chr2</td>
      <td>chr2</td>
      <td>100000.0</td>
      <td>100000.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>248</th>
      <td>chr2</td>
      <td>chr2</td>
      <td>chr2</td>
      <td>chr2</td>
      <td>100000.0</td>
      <td>100000.0</td>
      <td>50000.0</td>
    </tr>
    <tr>
      <th>249</th>
      <td>chr2</td>
      <td>chr2</td>
      <td>chr2</td>
      <td>chr2</td>
      <td>100000.0</td>
      <td>100000.0</td>
      <td>100000.0</td>
    </tr>
  </tbody>
</table>
<p>250 rows × 7 columns</p>
</div>

<h2 id="aggregating-genomic-data-based-on-its-distance-to-a-target-region">Aggregating genomic data based on it's distance to a target region</h2>
<p>In this example, we extend the above use-case to aggregate the results based on the distance columns added. This is a common use-case to calculate aggregate statistics for different distance levels. To achieve this, we employ the same query plan as above and extend it using the <code>DistanceAggregation</code> query step.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="kn">from</span> <span class="nn">spoc.query_engine</span> <span class="kn">import</span> <span class="n">DistanceAggregation</span><span class="p">,</span> <span class="n">AggregationFunction</span>
</span></code></pre></div>
<p>The <code>DistanceAggregation</code> class requires the following parameters:
- <code>value_columns</code>: Thie specifies the value to aggregate
- <code>function</code>: The aggregation function to use. This is the enumerated type <code>AggregationFunction</code>
- <code>densify_output</code>: Whether missing distance values should be filled with empty values (specific empty value depends on the aggregation function)</p>
<p>Note that there are two different average functions available, <code>AVG</code> and <code>AVG_WITH_EMPTY</code>. <code>AVG</code> performs and average over all available columns, where as <code>AVG_WITH_EMPTY</code> counts missing distances per regions as 0.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">query_steps</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>    <span class="n">Overlap</span><span class="p">(</span><span class="n">target_regions</span><span class="p">,</span> <span class="n">anchor_mode</span><span class="o">=</span><span class="n">Anchor</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;ALL&quot;</span><span class="p">)),</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>    <span class="n">DistanceTransformation</span><span class="p">(),</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>    <span class="n">DistanceAggregation</span><span class="p">(</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>        <span class="n">value_column</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>        <span class="n">function</span><span class="o">=</span><span class="n">AggregationFunction</span><span class="o">.</span><span class="n">AVG</span><span class="p">,</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>    <span class="p">),</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="p">]</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">Query</span><span class="p">(</span><span class="n">query_steps</span><span class="o">=</span><span class="n">query_steps</span><span class="p">)</span>\
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>    <span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">pixels</span><span class="p">)</span>\
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>    <span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>distance_1</th>
      <th>distance_2</th>
      <th>distance_3</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-100000.0</td>
      <td>-100000.0</td>
      <td>-100000.0</td>
      <td>4.5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-100000.0</td>
      <td>-100000.0</td>
      <td>-50000.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-100000.0</td>
      <td>-100000.0</td>
      <td>0.0</td>
      <td>5.5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-100000.0</td>
      <td>-100000.0</td>
      <td>50000.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-100000.0</td>
      <td>-100000.0</td>
      <td>100000.0</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>120</th>
      <td>100000.0</td>
      <td>100000.0</td>
      <td>-100000.0</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>121</th>
      <td>100000.0</td>
      <td>100000.0</td>
      <td>-50000.0</td>
      <td>4.5</td>
    </tr>
    <tr>
      <th>122</th>
      <td>100000.0</td>
      <td>100000.0</td>
      <td>0.0</td>
      <td>4.5</td>
    </tr>
    <tr>
      <th>123</th>
      <td>100000.0</td>
      <td>100000.0</td>
      <td>50000.0</td>
      <td>4.5</td>
    </tr>
    <tr>
      <th>124</th>
      <td>100000.0</td>
      <td>100000.0</td>
      <td>100000.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>125 rows × 4 columns</p>
</div>

<p>In addition, we can also aggregate on a subset of distance positions, using the <code>position_list</code> parameter:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">query_steps</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>    <span class="n">Overlap</span><span class="p">(</span><span class="n">target_regions</span><span class="p">,</span> <span class="n">anchor_mode</span><span class="o">=</span><span class="n">Anchor</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;ALL&quot;</span><span class="p">)),</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>    <span class="n">DistanceTransformation</span><span class="p">(),</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>    <span class="n">DistanceAggregation</span><span class="p">(</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>        <span class="n">value_column</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>        <span class="n">function</span><span class="o">=</span><span class="n">AggregationFunction</span><span class="o">.</span><span class="n">AVG</span><span class="p">,</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>        <span class="n">position_list</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>    <span class="p">),</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="p">]</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">Query</span><span class="p">(</span><span class="n">query_steps</span><span class="o">=</span><span class="n">query_steps</span><span class="p">)</span>\
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>    <span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">pixels</span><span class="p">)</span>\
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>    <span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>distance_1</th>
      <th>distance_2</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-100000.0</td>
      <td>-100000.0</td>
      <td>4.8</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-100000.0</td>
      <td>-50000.0</td>
      <td>4.5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-100000.0</td>
      <td>0.0</td>
      <td>5.3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-100000.0</td>
      <td>50000.0</td>
      <td>4.7</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-100000.0</td>
      <td>100000.0</td>
      <td>5.3</td>
    </tr>
    <tr>
      <th>5</th>
      <td>-50000.0</td>
      <td>-100000.0</td>
      <td>4.8</td>
    </tr>
    <tr>
      <th>6</th>
      <td>-50000.0</td>
      <td>-50000.0</td>
      <td>4.4</td>
    </tr>
    <tr>
      <th>7</th>
      <td>-50000.0</td>
      <td>0.0</td>
      <td>4.5</td>
    </tr>
    <tr>
      <th>8</th>
      <td>-50000.0</td>
      <td>50000.0</td>
      <td>5.4</td>
    </tr>
    <tr>
      <th>9</th>
      <td>-50000.0</td>
      <td>100000.0</td>
      <td>3.4</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.0</td>
      <td>-100000.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.0</td>
      <td>-50000.0</td>
      <td>3.5</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>4.4</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0.0</td>
      <td>50000.0</td>
      <td>5.4</td>
    </tr>
    <tr>
      <th>14</th>
      <td>0.0</td>
      <td>100000.0</td>
      <td>4.3</td>
    </tr>
    <tr>
      <th>15</th>
      <td>50000.0</td>
      <td>-100000.0</td>
      <td>5.3</td>
    </tr>
    <tr>
      <th>16</th>
      <td>50000.0</td>
      <td>-50000.0</td>
      <td>4.7</td>
    </tr>
    <tr>
      <th>17</th>
      <td>50000.0</td>
      <td>0.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>50000.0</td>
      <td>50000.0</td>
      <td>4.2</td>
    </tr>
    <tr>
      <th>19</th>
      <td>50000.0</td>
      <td>100000.0</td>
      <td>6.1</td>
    </tr>
    <tr>
      <th>20</th>
      <td>100000.0</td>
      <td>-100000.0</td>
      <td>5.4</td>
    </tr>
    <tr>
      <th>21</th>
      <td>100000.0</td>
      <td>-50000.0</td>
      <td>2.8</td>
    </tr>
    <tr>
      <th>22</th>
      <td>100000.0</td>
      <td>0.0</td>
      <td>3.6</td>
    </tr>
    <tr>
      <th>23</th>
      <td>100000.0</td>
      <td>50000.0</td>
      <td>5.2</td>
    </tr>
    <tr>
      <th>24</th>
      <td>100000.0</td>
      <td>100000.0</td>
      <td>4.3</td>
    </tr>
  </tbody>
</table>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.top"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.8fd75fb4.min.js"></script>
      
    
  </body>
</html>